<main class="container mx-auto p-4 sm:p-6 lg:p-8">
  <!-- Header -->
  <header class="mb-8">
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div>
        <h1 class="text-3xl font-bold text-gray-800 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-3 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" />
          </svg>
          API & Data Hub
        </h1>
        <p class="mt-1 text-gray-500">Your single source of truth for backend integration and database schemas.</p>
      </div>
    </div>
  </header>

  <!-- Info Banner -->
  <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-md mb-8">
    <div class="flex">
      <div class="flex-shrink-0">
        <svg class="h-5 w-5 text-blue-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
        </svg>
      </div>
      <div class="ml-3">
        <p class="text-sm text-blue-700">
          This hub provides the complete backend implementation guide for each dashboard, including data ingestion scripts, database schemas (DDL), and API logic (Stored Procedures). As a solo developer, you can use this as your blueprint to build the entire backend.
        </p>
      </div>
    </div>
  </div>

  <div class="flex flex-col md:flex-row gap-8">
    <!-- Navigation Sidebar -->
    <aside class="md:w-1/4">
      <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Data Modules</h2>
      <nav class="space-y-1">
        <button (click)="selectSection('commandCenter')" [class]="activeSection() === 'commandCenter' ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-100'" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-left">Ops Command Center</button>
        <button (click)="selectSection('incidents')" [class]="activeSection() === 'incidents' ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-100'" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-left">SLA Incidents</button>
        <button (click)="selectSection('predictiveBriefing')" [class]="activeSection() === 'predictiveBriefing' ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-100'" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-left">Predictive Briefing</button>
        <button (click)="selectSection('aiRoi')" [class]="activeSection() === 'aiRoi' ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-100'" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-left">AI ROI Analytics</button>
        <button (click)="selectSection('towerReport')" [class]="activeSection() === 'towerReport' ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-100'" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-left">Tower Deep Dive Report</button>
        <button (click)="selectSection('towerReportTrends')" [class]="activeSection() === 'towerReportTrends' ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-100'" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-left">Deep Dive Trends</button>
        <button (click)="selectSection('fteBalancing')" [class]="activeSection() === 'fteBalancing' ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-100'" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-left">FTE Balancing</button>
        <button (click)="selectSection('handovers')" [class]="activeSection() === 'handovers' ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-100'" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-left">Handover Hub</button>
        <button (click)="selectSection('onCallRoster')" [class]="activeSection() === 'onCallRoster' ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-100'" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-left">On-call Roster</button>
        <button (click)="selectSection('compliance')" [class]="activeSection() === 'compliance' ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-100'" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-left">Email Compliance</button>
        <button (click)="selectSection('admin')" [class]="activeSection() === 'admin' ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-100'" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-left">Admin & Master Data</button>
        <button (click)="selectSection('postmortems')" [class]="activeSection() === 'postmortems' ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-100'" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-left">Postmortem Reports</button>
      </nav>
    </aside>

    <!-- Content Area -->
    <div class="flex-1">
      <!-- Ops Command Center Section -->
      @if (activeSection() === 'commandCenter') {
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="p-5">
            <h2 class="text-xl font-bold text-gray-800">Ops Command Center</h2>
            <p class="mt-1 text-sm text-gray-600">End-to-end data pipeline for pulling data, consolidating it, and exposing it to the UI.</p>
          </div>
          <div class="border-b border-gray-200 px-5">
            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
              <button (click)="selectTab('commandCenter', 'guide')" [class]="activeTab()['commandCenter'] === 'guide' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Implementation Guide</button>
              <button (click)="selectTab('commandCenter', 'ingestion')" [class]="activeTab()['commandCenter'] === 'ingestion' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Ingestion Script</button>
              <button (click)="selectTab('commandCenter', 'db')" [class]="activeTab()['commandCenter'] === 'db' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Database Schema</button>
              <button (click)="selectTab('commandCenter', 'consolidation')" [class]="activeTab()['commandCenter'] === 'consolidation' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Consolidation Logic</button>
              <button (click)="selectTab('commandCenter', 'api')" [class]="activeTab()['commandCenter'] === 'api' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API Logic</button>
              <button (click)="selectTab('commandCenter', 'json')" [class]="activeTab()['commandCenter'] === 'json' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API JSON Response</button>
               <button (click)="selectTab('commandCenter', 'sample')" [class]="activeTab()['commandCenter'] === 'sample' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Sample Tables Preview</button>
            </nav>
          </div>
          @if(activeTab()['commandCenter'] === 'guide') {
            <div class="p-5 text-sm markup" [innerHTML]="commandCenterGuide"></div>
          }
          @if(activeTab()['commandCenter'] === 'ingestion') {
            <div class="p-5 space-y-4">
               <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                  <button (click)="selectIngestionSource('servicenow')" [class]="activeIngestionSource() === 'servicenow' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap pb-2 px-1 border-b-2 font-medium text-xs">From ServiceNow</button>
                  <button (click)="selectIngestionSource('databricks')" [class]="activeIngestionSource() === 'databricks' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap pb-2 px-1 border-b-2 font-medium text-xs">From Databricks</button>
                </nav>
              </div>
              @if (activeIngestionSource() === 'servicenow') {
                <div>
                    <h3 class="font-semibold text-gray-700">Python Ingestion Script (from ServiceNow)</h3>
                    <p class="text-sm text-gray-600 mt-1">This script should be run on a schedule (e.g., hourly) to pull incremental data from the ServiceNow Table API and upsert it into the staging table in your MS SQL "Smart Database".</p>
                    <div class="relative bg-gray-800 p-4 rounded-md mt-2">
                        <pre><code class="language-python text-sm text-gray-300 whitespace-pre-wrap">{{ commandCenterIngestionServiceNow }}</code></pre>
                        <button (click)="copyToClipboard('commandCenterIngestionServiceNow', commandCenterIngestionServiceNow)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'commandCenterIngestionServiceNow' ? 'Copied!' : 'Copy' }}</button>
                    </div>
                </div>
              }
              @if (activeIngestionSource() === 'databricks') {
                 <div>
                    <h3 class="font-semibold text-gray-700">Python Ingestion Script (from Databricks)</h3>
                    <p class="text-sm text-gray-600 mt-1">This script runs on a schedule to incrementally pull refined data from a Databricks SQL Warehouse and efficiently merge it into the MS SQL staging table.</p>
                    <div class="relative bg-gray-800 p-4 rounded-md mt-2">
                        <pre><code class="language-python text-sm text-gray-300 whitespace-pre-wrap">{{ commandCenterIngestionDatabricks }}</code></pre>
                        <button (click)="copyToClipboard('commandCenterIngestionDatabricks', commandCenterIngestionDatabricks)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'commandCenterIngestionDatabricks' ? 'Copied!' : 'Copy' }}</button>
                    </div>
                </div>
              }
            </div>
          }
          @if(activeTab()['commandCenter'] === 'db') {
            <div class="p-5 space-y-4">
              <div>
                  <h3 class="font-semibold text-gray-700">MS SQL Server DDL (CREATE TABLE)</h3>
                  <p class="text-sm text-gray-600 mt-1">The complete schema required to store all data for the Command Center.</p>
                  <div class="relative bg-gray-800 p-4 rounded-md mt-2">
                      <pre><code class="language-sql text-sm text-gray-300 whitespace-pre-wrap">{{ commandCenterDdl }}</code></pre>
                      <button (click)="copyToClipboard('commandCenterDdl', commandCenterDdl)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'commandCenterDdl' ? 'Copied!' : 'Copy' }}</button>
                  </div>
              </div>
            </div>
          }
          @if(activeTab()['commandCenter'] === 'consolidation') {
            <div class="p-5 space-y-4">
               <div>
                  <h3 class="font-semibold text-gray-700">Daily Consolidation Stored Procedure</h3>
                   <p class="text-sm text-gray-600 mt-1">This procedure should be run once daily to process the raw data and populate the final aggregated tables. It calculates all the complex KPIs for the dashboard.</p>
                  <div class="relative bg-gray-800 p-4 rounded-md mt-2">
                      <pre><code class="language-sql text-sm text-gray-300 whitespace-pre-wrap">{{ commandCenterConsolidationSp }}</code></pre>
                      <button (click)="copyToClipboard('commandCenterConsolidationSp', commandCenterConsolidationSp)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'commandCenterConsolidationSp' ? 'Copied!' : 'Copy' }}</button>
                  </div>
              </div>
            </div>
          }
          @if(activeTab()['commandCenter'] === 'api') {
            <div class="p-5 space-y-4">
              <div>
                <h3 class="font-semibold text-gray-700">API Stored Procedure</h3>
                <p class="text-sm text-gray-600 mt-1">The API backend should call this single procedure to get the entire JSON payload for the dashboard. It efficiently queries the pre-aggregated tables and accepts a portfolio filter.</p>
                <div class="relative bg-gray-800 p-4 rounded-md mt-2">
                    <pre><code class="language-sql text-sm text-gray-300 whitespace-pre-wrap">{{ commandCenterApiSp }}</code></pre>
                    <button (click)="copyToClipboard('commandCenterApiSp', commandCenterApiSp)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'commandCenterApiSp' ? 'Copied!' : 'Copy' }}</button>
                </div>
              </div>
               <div class="text-sm markup" [innerHTML]="commandCenterApiExample"></div>
            </div>
          }
          @if(activeTab()['commandCenter'] === 'json') {
            @let content = prettyPrintJson(commandCenterSample());
            <div class="relative bg-gray-800 p-4">
                <pre><code class="language-json text-sm text-gray-300 whitespace-pre-wrap">{{ content }}</code></pre>
                <button (click)="copyToClipboard('commandCenterJson', content)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'commandCenterJson' ? 'Copied!' : 'Copy' }}</button>
            </div>
          }
           @if(activeTab()['commandCenter'] === 'sample') {
            <div class="p-5 space-y-4">
              <div>
                  <h3 class="font-semibold text-gray-700">Sample Table Preview</h3>
                  <p class="text-sm text-gray-600 mt-1">A preview of what the final, aggregated tables look like after the consolidation procedure runs.</p>
                  <div class="relative bg-gray-800 p-4 rounded-md mt-2">
                      <pre><code class="language-sql text-sm text-gray-300 whitespace-pre-wrap">{{ commandCenterSampleTables }}</code></pre>
                      <button (click)="copyToClipboard('commandCenterSampleTables', commandCenterSampleTables)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'commandCenterSampleTables' ? 'Copied!' : 'Copy' }}</button>
                  </div>
              </div>
            </div>
          }
        </div>
      }

      <!-- Incidents Section -->
      @if (activeSection() === 'incidents') {
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="p-5">
            <h2 class="text-xl font-bold text-gray-800">SLA Incidents (Watchtower)</h2>
            <p class="mt-1 text-sm text-gray-600">Schema for the main incident tracking and SLA watchtower dashboard.</p>
          </div>
          <div class="border-b border-gray-200 px-5">
            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
              <button (click)="selectTab('incidents', 'logic')" [class]="activeTab()['incidents'] === 'logic' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API & Backend Logic</button>
              <button (click)="selectTab('incidents', 'db')" [class]="activeTab()['incidents'] === 'db' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Database Schema</button>
              <button (click)="selectTab('incidents', 'json')" [class]="activeTab()['incidents'] === 'json' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API JSON Response</button>
            </nav>
          </div>
          @if(activeTab()['incidents'] === 'logic') {
            <div class="p-5 text-sm markup" [innerHTML]="incidentsApiLogic"></div>
          }
          @if(activeTab()['incidents'] === 'db') {
            <div class="p-5 space-y-4">
              <div>
                <h3 class="font-semibold text-gray-700">MySQL DDL (CREATE TABLE)</h3>
                <div class="relative bg-gray-800 p-4 rounded-md mt-2">
                  <pre><code class="language-sql text-sm text-gray-300 whitespace-pre-wrap">{{ incidentsDdl }}</code></pre>
                  <button (click)="copyToClipboard('incidentsDdl', incidentsDdl)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'incidentsDdl' ? 'Copied!' : 'Copy' }}</button>
                </div>
              </div>
              <div>
                <h3 class="font-semibold text-gray-700">Sample DML (INSERT)</h3>
                <div class="relative bg-gray-800 p-4 rounded-md mt-2">
                  <pre><code class="language-sql text-sm text-gray-300 whitespace-pre-wrap">{{ incidentsDml }}</code></pre>
                  <button (click)="copyToClipboard('incidentsDml', incidentsDml)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'incidentsDml' ? 'Copied!' : 'Copy' }}</button>
                </div>
              </div>
            </div>
          }
          @if(activeTab()['incidents'] === 'json') {
            @let content = prettyPrintJson(incidentSample());
            <div class="relative bg-gray-800 p-4">
              <pre><code class="language-json text-sm text-gray-300 whitespace-pre-wrap">{{ content }}</code></pre>
              <button (click)="copyToClipboard('incidentsJson', content)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'incidentsJson' ? 'Copied!' : 'Copy' }}</button>
            </div>
          }
        </div>
      }

      <!-- Predictive Briefing Section -->
      @if (activeSection() === 'predictiveBriefing') {
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="p-5">
            <h2 class="text-xl font-bold text-gray-800">Predictive Operations Briefing</h2>
            <p class="mt-1 text-sm text-gray-600">Backend implementation guide for generating the AI-powered dashboard briefing.</p>
          </div>
          <div class="border-b border-gray-200 px-5">
            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
              <button (click)="selectTab('predictiveBriefing', 'logic')" [class]="activeTab()['predictiveBriefing'] === 'logic' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API & Backend Logic</button>
              <button (click)="selectTab('predictiveBriefing', 'db')" [class]="activeTab()['predictiveBriefing'] === 'db' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Database Schema</button>
              <button (click)="selectTab('predictiveBriefing', 'json')" [class]="activeTab()['predictiveBriefing'] === 'json' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API JSON Response</button>
            </nav>
          </div>
          @if(activeTab()['predictiveBriefing'] === 'logic') {
            <div class="p-5 text-sm markup" [innerHTML]="predictiveBriefingApiLogic"></div>
          }
          @if(activeTab()['predictiveBriefing'] === 'db') {
            <div class="p-5 space-y-4 text-sm">
                <h3 class="font-semibold text-gray-700">Relevant Tables</h3>
                <p>This feature does not require new tables. It generates insights by querying existing data from the following schemas:</p>
                <ul class="list-disc list-inside mt-2 space-y-1">
                  <li><code class="bg-gray-100 p-1 rounded-sm text-xs">incidents</code>: Used for the Incident Volume and SLA Breach Risk forecasts.</li>
                  <li><code class="bg-gray-100 p-1 rounded-sm text-xs">fte_snapshots</code>: Used for the FTE Demand forecast.</li>
                </ul>
            </div>
          }
          @if(activeTab()['predictiveBriefing'] === 'json') {
            @let content = prettyPrintJson(predictiveBriefingSample());
            <div class="relative bg-gray-800 p-4">
              <pre><code class="language-json text-sm text-gray-300 whitespace-pre-wrap">{{ content }}</code></pre>
              <button (click)="copyToClipboard('predictiveBriefingJson', content)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'predictiveBriefingJson' ? 'Copied!' : 'Copy' }}</button>
            </div>
          }
        </div>
      }

      <!-- AI ROI Section -->
      @if (activeSection() === 'aiRoi') {
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="p-5">
            <h2 class="text-xl font-bold text-gray-800">AI ROI Analytics</h2>
            <p class="mt-1 text-sm text-gray-600">Backend logic for calculating AI effectiveness metrics from user feedback.</p>
          </div>
          <div class="border-b border-gray-200 px-5">
            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
              <button (click)="selectTab('aiRoi', 'logic')" [class]="activeTab()['aiRoi'] === 'logic' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API & Backend Logic</button>
              <button (click)="selectTab('aiRoi', 'db')" [class]="activeTab()['aiRoi'] === 'db' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Database Schema</button>
              <button (click)="selectTab('aiRoi', 'json')" [class]="activeTab()['aiRoi'] === 'json' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API JSON Response</button>
            </nav>
          </div>
          @if(activeTab()['aiRoi'] === 'logic') {
            <div class="p-5 text-sm markup" [innerHTML]="aiRoiApiLogic"></div>
          }
          @if(activeTab()['aiRoi'] === 'db') {
             <div class="p-5 text-sm">
                <p>This feature uses the <strong><code>incident_ai_feedback</code></strong> table from the SLA Incidents schema.</p>
             </div>
          }
          @if(activeTab()['aiRoi'] === 'json') {
            @let content = prettyPrintJson(aiRoiSample());
            <div class="relative bg-gray-800 p-4">
              <pre><code class="language-json text-sm text-gray-300 whitespace-pre-wrap">{{ content }}</code></pre>
              <button (click)="copyToClipboard('aiRoiJson', content)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'aiRoiJson' ? 'Copied!' : 'Copy' }}</button>
            </div>
          }
        </div>
      }

      <!-- Tower Deep Dive Section -->
      @if (activeSection() === 'towerReport') {
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="p-5">
            <h2 class="text-xl font-bold text-gray-800">Tower Deep Dive Report</h2>
            <p class="mt-1 text-sm text-gray-600">Database schema and logic for the monthly deep dive report.</p>
          </div>
          <div class="border-b border-gray-200 px-5">
            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
              <button (click)="selectTab('towerReport', 'logic')" [class]="activeTab()['towerReport'] === 'logic' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API & Backend Logic</button>
              <button (click)="selectTab('towerReport', 'db')" [class]="activeTab()['towerReport'] === 'db' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Database Schema</button>
              <button (click)="selectTab('towerReport', 'json')" [class]="activeTab()['towerReport'] === 'json' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API JSON Response</button>
            </nav>
          </div>
          @if(activeTab()['towerReport'] === 'logic') {
            <div class="p-5 text-sm markup" [innerHTML]="towerReportApiLogic"></div>
          }
          @if(activeTab()['towerReport'] === 'db') {
            <div class="p-5 space-y-4">
              <div>
                <h3 class="font-semibold text-gray-700">Schema Overview</h3>
                <p class="text-sm text-gray-600 mt-1">This schema uses a monthly snapshot model with a full audit trail. A backend process should aggregate raw data (from ticketing systems, etc.) and populate these tables. This makes loading the report fast and efficient.</p>
                 <h3 class="font-semibold text-gray-700 mt-2">Manager Adjustment & Other Data</h3>
                 <ul class="list-disc list-inside text-sm text-gray-600">
                    <li>The <strong>Manager Adjustment</strong> value is stored directly in the <code class="text-xs bg-gray-100 p-1 rounded">monthly_report_summaries</code> table.</li>
                    <li>The data for structured activities like "Response" and "Proactive" is stored in the <code class="text-xs bg-gray-100 p-1 rounded">monthly_structured_aggregates</code> table, which links to the <code class="text-xs bg-gray-100 p-1 rounded">master_activities</code> table to get the category name.</li>
                    <li>The entire report summary has an approval workflow and audit fields (<code class="text-xs bg-gray-100 p-1 rounded">created_by</code>, <code class="text-xs bg-gray-100 p-1 rounded">last_modified_by</code>, etc.) to track who entered and modified the data.</li>
                 </ul>
              </div>
              <div>
                <h3 class="font-semibold text-gray-700">MySQL DDL (CREATE TABLE)</h3>
                <div class="relative bg-gray-800 p-4 rounded-md mt-2">
                  <pre><code class="language-sql text-sm text-gray-300 whitespace-pre-wrap">{{ towerReportDdl }}</code></pre>
                  <button (click)="copyToClipboard('towerDdl', towerReportDdl)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'towerDdl' ? 'Copied!' : 'Copy' }}</button>
                </div>
              </div>
              <div>
                <h3 class="font-semibold text-gray-700">Sample DML (INSERT for July 2025 Report)</h3>
                <div class="relative bg-gray-800 p-4 rounded-md mt-2">
                  <pre><code class="language-sql text-sm text-gray-300 whitespace-pre-wrap">{{ towerReportDml }}</code></pre>
                  <button (click)="copyToClipboard('towerDml', towerReportDml)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'towerDml' ? 'Copied!' : 'Copy' }}</button>
                </div>
              </div>
            </div>
          }
          @if(activeTab()['towerReport'] === 'json') {
             @let content = prettyPrintJson(towerReportSample());
              <div class="relative bg-gray-800 p-4">
                <pre><code class="language-json text-sm text-gray-300 whitespace-pre-wrap">{{ content }}</code></pre>
                <button (click)="copyToClipboard('towerReportJson', content)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'towerReportJson' ? 'Copied!' : 'Copy' }}</button>
              </div>
          }
        </div>
      }

       <!-- Deep Dive Trends Section -->
      @if (activeSection() === 'towerReportTrends') {
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="p-5">
            <h2 class="text-xl font-bold text-gray-800">Deep Dive Trends</h2>
            <p class="mt-1 text-sm text-gray-600">Backend logic for the historical trends analysis page.</p>
          </div>
           <div class="border-b border-gray-200 px-5">
            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
              <button (click)="selectTab('towerReportTrends', 'logic')" [class]="activeTab()['towerReportTrends'] === 'logic' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API & Backend Logic</button>
              <button (click)="selectTab('towerReportTrends', 'db')" [class]="activeTab()['towerReportTrends'] === 'db' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Database Schema</button>
            </nav>
          </div>
           @if(activeTab()['towerReportTrends'] === 'logic') {
            <div class="p-5 text-sm markup" [innerHTML]="towerReportTrendsApiLogic"></div>
          }
          @if(activeTab()['towerReportTrends'] === 'db') {
             <div class="p-5 text-sm">
                <p>This feature uses the existing <strong>monthly snapshot tables</strong> from the Tower Deep Dive Report schema. No new tables are required. The API should query these tables over a date range to generate the trend data.</p>
             </div>
          }
        </div>
      }

      <!-- FTE Balancing Section -->
      @if (activeSection() === 'fteBalancing') {
         <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <!-- ... FTE Balancing Content ... -->
        </div>
      }

      <!-- Handover Hub Section -->
      @if (activeSection() === 'handovers') {
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <!-- ... Handover Hub Content ... -->
        </div>
      }

       <!-- On-call Roster Section -->
      @if (activeSection() === 'onCallRoster') {
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="p-5">
            <h2 class="text-xl font-bold text-gray-800">On-call Roster</h2>
            <p class="mt-1 text-sm text-gray-600">Schema for managing on-call schedules with external user data synchronization.</p>
          </div>
          <div class="border-b border-gray-200 px-5">
            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
              <button (click)="selectTab('onCallRoster', 'logic')" [class]="activeTab()['onCallRoster'] === 'logic' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API & Backend Logic</button>
              <button (click)="selectTab('onCallRoster', 'db')" [class]="activeTab()['onCallRoster'] === 'db' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Database Schema</button>
              <button (click)="selectTab('onCallRoster', 'json')" [class]="activeTab()['onCallRoster'] === 'json' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">API JSON Response</button>
            </nav>
          </div>
          @if(activeTab()['onCallRoster'] === 'logic') {
            <div class="p-5 text-sm markup" [innerHTML]="onCallRosterApiLogic"></div>
          }
          @if(activeTab()['onCallRoster'] === 'db') {
            <div class="p-5 space-y-4">
              <div>
                <h3 class="font-semibold text-gray-700">MySQL DDL (CREATE TABLE)</h3>
                <div class="relative bg-gray-800 p-4 rounded-md mt-2">
                  <pre><code class="language-sql text-sm text-gray-300 whitespace-pre-wrap">{{ onCallRosterDdl }}</code></pre>
                  <button (click)="copyToClipboard('onCallRosterDdl', onCallRosterDdl)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'onCallRosterDdl' ? 'Copied!' : 'Copy' }}</button>
                </div>
              </div>
              <div>
                <h3 class="font-semibold text-gray-700">Sample DML (INSERT)</h3>
                <div class="relative bg-gray-800 p-4 rounded-md mt-2">
                  <pre><code class="language-sql text-sm text-gray-300 whitespace-pre-wrap">{{ onCallRosterDml }}</code></pre>
                  <button (click)="copyToClipboard('onCallRosterDml', onCallRosterDml)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'onCallRosterDml' ? 'Copied!' : 'Copy' }}</button>
                </div>
              </div>
            </div>
          }
          @if(activeTab()['onCallRoster'] === 'json') {
            @let content = prettyPrintJson(onCallRosterSample());
            <div class="relative bg-gray-800 p-4">
              <pre><code class="language-json text-sm text-gray-300 whitespace-pre-wrap">{{ content }}</code></pre>
              <button (click)="copyToClipboard('onCallRosterJson', content)" class="absolute top-3 right-3 bg-gray-700 text-gray-300 hover:bg-gray-600 px-3 py-1 rounded text-xs font-medium">{{ copied() === 'onCallRosterJson' ? 'Copied!' : 'Copy' }}</button>
            </div>
          }
        </div>
      }

       <!-- Compliance Section -->
      @if (activeSection() === 'compliance') {
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <!-- ... Compliance Content ... -->
        </div>
      }

      <!-- Admin Section -->
      @if (activeSection() === 'admin') {
         <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <!-- ... Admin Content ... -->
        </div>
      }

       <!-- Postmortems Section -->
      @if (activeSection() === 'postmortems') {
         <div class="bg-white rounded-lg shadow-md overflow-hidden">
           <!-- ... Postmortems Content ... -->
        </div>
      }
    </div>
  </div>
</main>
