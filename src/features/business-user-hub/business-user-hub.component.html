<main class="h-[calc(100vh-140px)] flex">
  <!-- Left Column: My Services -->
  <aside class="w-1/3 bg-white border-r border-gray-200 p-6 flex flex-col">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">My Services</h2>
    <div class="flex-grow space-y-4 overflow-y-auto">
      @for (service of userServices(); track service.id) {
        <div class="p-4 rounded-lg border" [class]="service.status === 'Healthy' ? 'border-gray-200' : service.status === 'Degraded' ? 'border-yellow-300 bg-yellow-50' : 'border-red-300 bg-red-50'">
          <div class="flex items-center justify-between">
            <p class="font-semibold text-gray-900">{{ service.name }}</p>
            <div class="flex items-center gap-2">
              <span class="w-3 h-3 rounded-full" [class]="getServiceStatusClass(service.status)"></span>
              <span class="text-sm font-medium" [class]="service.status === 'Healthy' ? 'text-gray-600' : service.status === 'Degraded' ? 'text-yellow-700' : 'text-red-700'">{{ service.status }}</span>
            </div>
          </div>
          @if (service.businessImpact) {
            <p class="text-sm text-gray-600 mt-2">{{ service.businessImpact }}</p>
          }
        </div>
      }
    </div>
  </aside>

  <!-- Right Column: AI Concierge -->
  <div class="w-2/3 bg-gray-50 flex flex-col p-6">
    <div class="flex-grow flex flex-col bg-white rounded-lg shadow-md border overflow-hidden">
      <div class="p-4 border-b bg-gray-100">
        <h2 class="text-xl font-bold text-gray-800 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-blue-500" viewBox="0 0 20 20" fill="currentColor"><path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 01-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 013.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 013.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 01-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.25 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" /></svg>
          AI Concierge
        </h2>
      </div>

      <!-- Chat History -->
      <div class="flex-grow p-6 overflow-y-auto space-y-4 flex flex-col">
        @for (message of chatHistory(); track $index) {
          <div class="flex" [class]="message.sender === 'user' ? 'justify-end' : 'justify-start'">
            <div class="chat-bubble" [class]="message.sender === 'user' ? 'chat-bubble-user' : 'chat-bubble-ai'">
              <p [innerHTML]="message.text"></p>
            </div>
          </div>
        }
        @if (isLoadingResponse()) {
           <div class="flex justify-start">
             <div class="chat-bubble chat-bubble-ai">
                <div class="flex items-center gap-2">
                  <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div>
                  <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:0.2s]"></div>
                  <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:0.4s]"></div>
                </div>
             </div>
           </div>
        }
      </div>

      <!-- Input Area -->
      <div class="p-4 border-t bg-gray-50">
        <div class="flex gap-2 mb-2">
            @for(action of quickActions; track action) {
                <button (click)="sendQuery(action)" class="px-2 py-1 text-xs bg-gray-200 text-gray-700 rounded-full hover:bg-gray-300">{{action}}</button>
            }
        </div>
        <form (ngSubmit)="sendQuery()" class="flex items-center gap-4">
          <input [formControl]="chatQuery" type="text" placeholder="Ask a question or describe your issue..." class="flex-grow border-gray-300 rounded-md shadow-sm">
          <button type="submit" [disabled]="!chatQuery.value || isLoadingResponse()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400">
            Send
          </button>
        </form>
      </div>
    </div>
  </div>
</main>
