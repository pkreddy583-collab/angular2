<main class="p-4 sm:p-6 lg:p-8">
  @if (incident(); as incident) {
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6 sm:p-8">
      
      <!-- Incident Header -->
      <div>
        <h1 class="text-lg font-bold text-green-600">Incident Details</h1>
        <div class="w-16 h-1 bg-green-600 rounded-full mt-2"></div>
        <p class="mt-4 text-3xl font-bold text-gray-800">
          {{ incident.id }}: {{ incident.title }}
        </p>
      </div>

      <!-- Incident Description -->
      <div class="mt-6">
        <h2 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Description</h2>
        <p class="mt-2 text-gray-700 leading-relaxed">
          {{ incident.description }}
        </p>
      </div>

      <!-- Metadata -->
      <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8">
        <div>
          <h3 class="flex items-center text-sm font-semibold text-gray-500 uppercase tracking-wider">
            <svg class="h-5 w-5 mr-2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M11.75 2.75a.75.75 0 01.75.75V4h1.25a.75.75 0 010 1.5H3.25a.75.75 0 010-1.5H4.5V3.5A.75.75 0 015.25 2h6.5a.75.75 0 01.75.75zM4.5 7.5a.75.75 0 01.75-.75h9.5a.75.75 0 010 1.5H5.25a.75.75 0 01-.75-.75zM5.25 10a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5H5.25zM3 15a2 2 0 104 0 2 2 0 00-4 0zM6.5 15a.75.75 0 01.75-.75h6a.75.75 0 010 1.5h-6a.75.75 0 01-.75-.75z" clip-rule="evenodd" />
            </svg>
            Affected Services
          </h3>
          <div class="mt-3 flex flex-wrap gap-2">
            @for(service of incident.affectedServices; track service) {
              <span class="px-3 py-1 text-sm font-medium bg-green-100 text-green-800 rounded-full">
                {{ service }}
              </span>
            }
          </div>
        </div>
        <div>
          <h3 class="flex items-center text-sm font-semibold text-gray-500 uppercase tracking-wider">
             <svg class="h-5 w-5 mr-2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 2c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 2.5a.75.75 0 00-1.5 0v4.69L6.03 12.22a.75.75 0 10.94 1.18l3-2.5a.75.75 0 00.28-.53V4.5a.75.75 0 00-.75-.75z" clip-rule="evenodd" />
            </svg>
            Last Update
          </h3>
          <p class="mt-3 text-gray-700">
            {{ incident.lastUpdate }}
          </p>
        </div>
      </div>
      
      <hr class="my-8 border-gray-200" />

      <!-- AI Co-pilot -->
      <div class="bg-green-50/50 border border-green-200 rounded-lg p-6">
        <h2 class="flex items-center text-xl font-bold text-green-800">
          <svg class="h-6 w-6 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10.89 2.242a2.993 2.993 0 00-1.78 0 1.018 1.018 0 01-1.22 0 2.993 2.993 0 00-1.78 0 1.018 1.018 0 01-1.22 0 2.993 2.993 0 00-1.78 0 1.018 1.018 0 01-1.22 0A2.993 2.993 0 000 4.022v9.956a2.993 2.993 0 001.78 1.78 1.018 1.018 0 011.22 0 2.993 2.993 0 001.78 0 1.018 1.018 0 011.22 0 2.993 2.993 0 001.78 0 1.018 1.018 0 011.22 0 2.993 2.993 0 001.78 0 1.018 1.018 0 011.22 0 2.993 2.993 0 001.78 0 1.018 1.018 0 011.22 0 2.993 2.993 0 001.78-1.78V4.022a2.993 2.993 0 00-1.78-1.78 1.018 1.018 0 01-1.22 0 2.993 2.993 0 00-1.78 0 1.018 1.018 0 01-1.22 0 2.993 2.993 0 00-1.78 0 1.018 1.018 0 01-1.22 0zM8.22 6.22a.75.75 0 011.06 0l2.25 2.25a.75.75 0 010 1.06l-2.25 2.25a.75.75 0 01-1.06-1.06L9.94 9 8.22 7.28a.75.75 0 010-1.06z" />
          </svg>
          AI Co-pilot
        </h2>
        
        <!-- Tabs -->
        <div class="mt-4 border-b border-gray-200">
          <nav class="-mb-px flex space-x-6" aria-label="Tabs">
            <button (click)="selectTab('Triage')" [class]="activeTab() === 'Triage' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm flex items-center">
              <svg class="h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
              Triage
            </button>
            <button (click)="selectTab('Research')" [class]="activeTab() === 'Research' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm flex items-center">
              <svg class="h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>
              Research
            </button>
            <button (click)="selectTab('Timeline')" [class]="activeTab() === 'Timeline' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm flex items-center">
              <svg class="h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
              Timeline
            </button>
            <button (click)="selectTab('Exec Summary')" [class]="activeTab() === 'Exec Summary' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm flex items-center">
              <svg class="h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
              Exec Summary
            </button>
          </nav>
        </div>

        <!-- Tab Content -->
        <div class="pt-6">
          @if (activeTab() === 'Research') {
            <div class="bg-white p-4 rounded-md border border-gray-200">
              <p class="font-semibold text-blue-600">
                KB00202: Optimizing Database Indexing for Search
              </p>
              <p class="text-sm text-gray-600 mt-1">
                Best practices for creating and maintaining database indexes to improve the performance of complex search queries.
              </p>
              <hr class="my-3" />
              <div class="flex items-start">
                <svg class="h-5 w-5 mr-2 text-green-500 flex-shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 01-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 013.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 013.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 01-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.25 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" /></svg>
                <p class="text-sm text-gray-800">
                  <strong class="font-semibold">AI Gist:</strong> This article is relevant because the incident highlights slowness 'especially when accessing payroll information,' which often involves complex database queries that can be improved through indexing to reduce load on the application server and database.
                </p>
              </div>
            </div>
          }
        </div>

      </div>

    </div>
  } @else {
    <div class="text-center py-20">
      <p class="text-gray-500">Loading incident details...</p>
    </div>
  }
</main>