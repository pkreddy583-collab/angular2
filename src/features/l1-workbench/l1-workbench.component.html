<main class="container mx-auto p-4 sm:p-6 lg:p-8">
  <!-- Header -->
  <header class="mb-8 text-center">
    <h1 class="text-4xl font-extrabold text-gray-800 flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mr-3 text-blue-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 18.75V8.843a1.5 1.5 0 00-1.012-1.423l-4.522-1.472a1.5 1.5 0 01-1.012-1.423V3.543A2.652 2.652 0 0012.25 1h-2.5A2.652 2.652 0 007.1 3.543v2.404a1.5 1.5 0 01-1.012 1.423l-4.522 1.472A1.5 1.5 0 001 8.843v9.907a2.652 2.652 0 003.75 2.582l5.67-3.616zM11.42 15.17l2.472-2.473a1.5 1.5 0 000-2.122L11.42 8.122m0 7.048L8.122 11.42m3.298 3.75l-.422-.422a1.5 1.5 0 010-2.122l.422-.422m0 2.964l2.473-2.473" />
      </svg>
      L1 AI Workbench
    </h1>
    <p class="mt-2 text-lg text-gray-500 max-w-2xl mx-auto">Your co-pilot for triaging and resolving user issues faster.</p>
  </header>

  <div class="max-w-4xl mx-auto">
    <!-- Input Section -->
    <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
      <label for="problemDescription" class="block text-lg font-semibold text-gray-800">Describe the User's Issue</label>
      <p class="text-sm text-gray-500 mt-1 mb-3">
        Paste in a ticket summary or describe the problem in plain English. Include user IDs, application names, and error messages for the best results.
      </p>
      <textarea 
        id="problemDescription" 
        [formControl]="problemDescription" 
        rows="5" 
        class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500" 
        placeholder="e.g., User 'jsmith' cannot access the HR Portal. They are receiving an authentication error after entering their credentials.">
      </textarea>
      <div class="mt-4 flex justify-end gap-4">
        <button (click)="reset()" [class.hidden]="!triageResult() && !isLoading()">Clear</button>
        <button 
          (click)="analyzeProblem()" 
          [disabled]="problemDescription.invalid || isLoading()"
          class="inline-flex items-center justify-center px-6 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400">
          @if (isLoading()) {
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
            <span>Analyzing...</span>
          } @else {
            <span>Analyze with Strider AI</span>
          }
        </button>
      </div>
    </div>

    <!-- Results Section -->
    <div class="mt-8">
      @if (error()) {
        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md" role="alert">
          <p class="font-bold">Error</p>
          <p>{{ error() }}</p>
        </div>
      }

      @if (triageResult(); as result) {
        <div class="space-y-6 animate-fade-in">
          <!-- AI Summary -->
          <div class="bg-white p-5 rounded-lg shadow-sm border">
            <h3 class="font-semibold text-gray-800 text-lg flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
              AI Triage Summary
            </h3>
            <p class="text-gray-600 mt-2 text-sm">{{ result.summary }}</p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Left Column in Results -->
            <div class="space-y-6">
              <!-- Suggested Actions -->
              <div class="bg-white p-5 rounded-lg shadow-sm border">
                <h3 class="font-semibold text-gray-800 text-lg flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-500" viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" /></svg>
                  Suggested Actions
                </h3>
                <div class="mt-3 space-y-3">
                  @for (action of result.suggestedActions; track action.text) {
                    <label class="flex items-start p-3 bg-gray-50 rounded-md hover:bg-gray-100 cursor-pointer">
                      <input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mt-0.5" [checked]="action.done" (change)="toggleAction(action)">
                      <span class="ml-3 text-sm text-gray-700" [class.line-through]="action.done">{{ action.text }}</span>
                    </label>
                  }
                </div>
              </div>
            </div>

            <!-- Right Column in Results -->
            <div class="space-y-6">
              <!-- Relevant Knowledge -->
              <div class="bg-white p-5 rounded-lg shadow-sm border">
                <h3 class="font-semibold text-gray-800 text-lg">Relevant Knowledge</h3>
                <div class="mt-3 space-y-2">
                  @for (kb of result.relevantKnowledge; track kb.id) {
                    <a href="#" class="block text-sm text-blue-600 hover:underline">{{ kb.id }}: {{ kb.title }}</a>
                  }
                </div>
              </div>

              <!-- Escalation & Change Request -->
              @if (result.escalationPath) {
                <div class="bg-yellow-50 p-5 rounded-lg border border-yellow-300">
                  <h3 class="font-semibold text-yellow-800 text-lg">Escalation Required</h3>
                  <p class="mt-2 text-sm text-yellow-700">This issue likely requires L2/L3 support. Please escalate to:</p>
                  <p class="font-bold text-yellow-900 mt-1">{{ result.escalationPath }}</p>
                </div>
              }

              @if (result.requiresChange && result.changeRequestDetails) {
                <div class="bg-green-50 p-5 rounded-lg border border-green-300">
                  <h3 class="font-semibold text-green-800 text-lg">Change Request Suggested</h3>
                  <p class="text-sm mt-2"><strong>Title:</strong> {{ result.changeRequestDetails.title }}</p>
                  <p class="text-sm mt-1"><strong>Risk:</strong> {{ result.changeRequestDetails.risk }}</p>
                  <button class="mt-3 text-sm font-semibold text-green-700 hover:underline">Create Change Request &rarr;</button>
                </div>
              }
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</main>
